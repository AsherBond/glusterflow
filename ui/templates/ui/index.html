<html>{% load staticfiles %}
<head>
    <!-- Refresh the page every minute -->
    <!-- Probably need some way for users to control/disable this -->
    <meta http-equiv="refresh" content="60" />

    <script src="{% static 'ui/js/raphael-min.js.gz' %}"></script>
    <script src="{% static 'ui/js/g.raphael-min.js.gz' %}"></script>
    <script src="{% static 'ui/js/g.bar-min.js.gz' %}"></script>
    <script src="{% static 'ui/js/g.dot-min.js.gz' %}"></script>
    <script src="{% static 'ui/js/g.line-min.js.gz' %}"></script>
    <script src="{% static 'ui/js/g.pie-min.js.gz' %}"></script>
    <script>
        // Javascript to display the bar chart
        window.onload = function () {
            var r;
            // Set up the bar chart and hover animation
            r  = Raphael("chart"),
                fin = function () {
                    this.flag = r.popup(this.bar.x, this.bar.y,
                                        this.bar.value || "0").insertBefore(this);
                },
                fout = function () {
                    this.flag.animate({opacity: 0}, 300, function () {this.remove();});
                },
                txtattr = { font: "13px sans-serif" },
                txtattr_big = { font: "14px sans-serif" };

            // Render the barchart
            r.barchart(0, 0, 600, 260, [

                // Create the array of column values
                {% for count in counts reversed %}
                    {{ count }},
                {% endfor %}
                    ],{'type': 'soft', 'colors': [

                // Create the array of colour values
                {% for count in counts reversed %}
                    {% if count != highest_count %}
                        "blue",
                    {% else %}
                        "red",
                    {% endif %}
                {% endfor %}
                    ]}).hover(fin, fout);

            // Render the accompanying text
            r.text(310, 260, "File operations over the past 4 hours").attr(txtattr_big);
            r.text(310, 282, "Each bar is {{ delta }} minutes").attr(txtattr_big);
            r.text(28, 250, "4 hrs ago").attr(txtattr);
            r.text(569, 250, "Now").attr(txtattr);
        };
    </script>
    <script>
        // Data array of busiest files
        var busy_files = [{% for outer_row in busiest_files %}
                [{% for inner_row in outer_row %}['{{ inner_row.filename }}', {{ inner_row.count }}]{% if not forloop.last %},{% endif %}{% endfor %}]{% if not forloop.last %},{% endif %}{% endfor %}];
    </script>
</head>
<body>
    <h2>GlusterFlow : Host usage profile over time</h2>
    Data from {{ right_now }}
    <div id="chart"></div>
    <div id="info_rows">
        <h3>Busiest files</h3>
        <table id="busy_files">
            <tr><th align="left">Filename</td><th># of file operations</td></tr>

            {% for row in busiest_files %}
            <tr><td align="left">{{ row.filename }}</td><td>{{ row.count }}</td></tr>
            {% endfor %}
        </table>
    </div>
    <br />
    <div id="extra">
        This page took {{ processing_time }} seconds to create.
    </div>
</body>
</html>
